<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Wichtel-Spiel</title>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #111;
  color: #fff;
  margin: 0;
  padding: 16px;
  text-align: center;
}

h2 {
  font-size: 1.5rem;
  margin-top: 10px;
}

p {
  font-size: 1.1rem;
  line-height: 1.4;
  margin-top: 12px;
}

img {
  width: 100%;
  max-width: 420px;
  height: auto;
  border-radius: 12px;
  margin: 20px auto;
  display: block;
}
</style>
</head>

<body>

<h2 id="title"></h2>
<img id="img" alt="">
<p id="text"></p>

<script>
const MAX_TIME = 5 * 60 * 1000; // 5 Minuten

const storyTexts = {
  1: "üìú Die Legende beginnt‚Ä¶ Ein Wichtel hat sich unauff√§llig unter euch gemischt. Noch ist seine Tarnung perfekt.",
  2: "üî¶ Erste Umrisse tauchen auf. Der Wichtel beobachtet euch ‚Äì und bleibt ganz ruhig.",
  3: "üß† Die Tarnung beginnt zu br√∂ckeln. Einige Gesichter wirken pl√∂tzlich‚Ä¶ verd√§chtig.",
  4: "üëÅÔ∏è Ihr seid nah dran. Sehr nah. Der Wichtel wird nerv√∂s.",
  5: "‚ö†Ô∏è Letzte Chance zur Flucht. Niemand hat sie genutzt.",
  6: "üéÖ Der Wichtel ist entlarvt! Die M√ºtze l√ºgt nicht."
};

const params = new URLSearchParams(window.location.search);
const step = Number(params.get("s"));

const now = Date.now();
let progress = Number(localStorage.getItem("progress")) || 0;
let lastTime = Number(localStorage.getItem("lastTime")) || 0;

// ‚è±Ô∏è Automatischer Reset nach 5 Minuten Inaktivit√§t
if (now - lastTime > MAX_TIME) {
  progress = 0;
  localStorage.setItem("progress", 0);
}

// ‚ùå Falsche Reihenfolge
if (step !== progress + 1) {
  localStorage.setItem("progress", 0);
  localStorage.setItem("lastTime", now);

  document.getElementById("title").innerText = "‚ùå Spur verloren";
  document.getElementById("text").innerText =
    "Die F√§hrte ist kalt. Bitte wieder bei QR-Code 1 beginnen.";
} 
// ‚úÖ Richtiger Schritt
else {
  localStorage.setItem("progress", step);
  localStorage.setItem("lastTime", now);

  document.getElementById("img").src = `step${step}.jpg`;
  document.getElementById("text").innerText = storyTexts[step];

  if (step < 6) {
    document.getElementById("title").innerText = "üß© Spur gefunden";
  } else {
    document.getElementById("title").innerText = "üéÑ Finale";
  }
}
</script>

</body>
</html>
